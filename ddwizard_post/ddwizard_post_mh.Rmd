---
title: "DD Wizard Blog Post"
author: ""
date: "April 30, 2019"
output: html_document
runtime: shiny
---

# A web interface for declaring and diagnosing research designs 

 [DeclareDesign](www.declaredesign.org) is a collection of tools to help you  "declare" and "diagnose" research designs. In a word, with the DeclareDesign packages you can quickly state the core analysis-relevant features of a research design, and in return you will get a diagnosis, telling you how well your design is likely to perform and how changes in the design could improve performance. 

That's the good news. The bad news, for some at least, is that it's all set up in `R`. That's a dealbreaker for many.    

Enter [DDWizard](https://eos.wzb.eu/ipi/DDWizard). DDwizard is a web interface that lets you select any design from a growing library of design templates (available in the R package [_DesignLibrary_](https://cran.r-project.org/web/packages/DesignLibrary/DesignLibrary.pdf)), customize them, and interrogate them.  All without ever having to look at any code.

The wizard is structured with a `Design` tab that lets you load and customize a design and a second `Diagnose` tab that lets you interogate the design---generating nice plots showing how the design performs compared to other similar designs 

<!-- ## How does it work? -->

<!-- <!-- REVIEW: This intro bit could be replaced with introJS feature Sisi is working on. (Instead of below we could have screenshots of the JSIntro window showing step by step would contain similar text and indicate which buttons we are referring to more precisely.) --> 

<!-- `DESIGN` tab: -->

<!-- * load an existing design template from the library and customize it (`Set design parameters` panel); -->
<!-- * inspect design features (`Summary` panel); -->
<!-- * visualize and download the R code that produces the design in either ".R" or ".RDS" format (`Code output` panel) ; and -->
<!-- * visualize and download simulated data for the design (`Simulated data` panel). -->

<!-- `DIAGNOSE` tab: -->

<!-- * compare the properties of different designs by varying one or more parameters (`Compare design parameters` panel) and configuring simulations (`Configure simulations` panel); -->
<!-- * -->
<!-- * visualize above comparison in graph (`Diagnostic plots` panel) or table format (`Diagnosis` panel) by selecting specific estimands, estimators, coefficients, and diagnosands of interest (`Plot configuration` panel). -->

<!-- Additionally, users can also share the status of their inputs and outputs (simulated data, graphs and tables) by using the URL provided by the `SHARE` button on top right corner. Value inputs and simulations are cached and loaded upon re-entering the token link on the browser. -->

# Six Things to Do with the Declare Design Wizard

Here are six things you can do with the wizard.

## 1 Create a design and share it

The DeclareDesign library contains a set of templates for generating many common designs. In each case a complete design usually requires specifying a model of how the world works, inquiries (estimands), data strategies (sampling and assignment) and answer strategies (estimates) (see [here](https://declaredesign.org/declare.pdf) for more detail).

We think of the library as containing lots of designs, but really it contains what we call "designers"---functions for making designs. The library includes simple experimental designers, as well as designers for factorial and multiarm experiments. It also has designers for observational studies, such as regression discontinuinty designs or instrumental variables designs. And it even has some designers for simple qualitative studies, such as process tracing. 

Each `designer` in the library seeks some key inputs and uses those to generate the design, and these are normally different for every type of design. 

Suppose for instance you were interested in a factorial design with three binary factors ($2\times2\times2$ treatment conditions). The factorial designer in the DesignLibrary lets you  specify the sample size, the number of binary factors, the indepedent assignment probability within each factor, and the mean and standard deviations of the outcome means for each of the eight treatment conditions.

Key aspects of the design such as the model, estimand and estimates are predefined and documented in the factorial vignette linked in the app ("Read more" button). Once you plug in the values relevant for your study you can download or directly share the design. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(shiny); library(shinyjs); library(shinymaterial)
source("ddwizard_post_helpers.R")

text1 <- c(
  add_title("Load a design template",
            "Select and load the 'Factorial' design. To learn about this design template in more detail, click on <code>Read more</code>. <p> <p> The <code>?</code> button will redirect to the full database of design templates."),

  add_title("Set values of design parameters",
            "This creates a design with <code>N</code> observations in which each of the three factors (<code>k</code>) are assigned with probabilities given by <code>assignment probs</code>. We can ex ante declare our expectations of outcome means and standard deviations for each combination of factors in <code>outcome means</code> and <code>outcome sds</code> from which to draw normally distributed potential outcomes. Users can also customize <code>outcome name</code> and <code>treatment names</code>. <p><p> Values for all these parameters can be specified in 'Set design parameters'. </p>"),

    add_title("Fix parameter",
            "When creating a design, users can specify whether they want to hard code any or all parameters in design code. This means that the R code exported will prevent other users to easily redefine the values of these parameters. Any parameters set to 'fixed' will also be omitted from the 'DIAGNOSIS' tab sidebar, which prevents users from seeing how the design performs under different specifications of these parameters."),

  add_title("See summary of design",
            "Having specified values for all arguments of the design, users can inspect the design step-by-step such as which variables are created by the design, the number of units assigned to each treatment condition, a single draw of the estimands and a single draw of the estimates."),

  add_title("Export design code",
            "Users can download the R code that generates that design as an '.R' file (R script) or in '.RDS' format (which contains the design object and can be onto an R session with the function <code>readRDS()</code>). <p><p> Users can then share this R code with say, co-authors, who are then able to replicate the same design and examine and/or update its assumptions and any of its analytical features."),

    add_title("Share the app status",
            "Instead of downloading outputs, users can simply cache all input values and any ouputs by clicking on the 'SHARE' button on the top-right corner. The resulting browser URL will restore the app status, meaning that anyone else opening it will be able to see the exact same values displayed in input boxes and panels. This applies to both 'DESIGN' and 'DIAGNOSIS' tabs. (We can only guarantee storage of cache for 30 days.)"),

  add_title("Download simulated data",
            "Download a '.csv' file containing a single simulation of the data generated by the design."))

imageGallery("ex1", text1)
```

## 2. Improve your design

For any design selected, you can use the diagnosis tab to further inspect design properites such as power, bias, and root mean squared error (RMSE), under different values of one or more parameters. Interactive graphs and tables make it easy for users to visualize trends and trade-offs between alternative design specifications.

Below we offer an example where we examine how sample size and mean outcomes in the $2^3$ factorial design above affect the power of the average effect estimates. This can help inform researchers over whether a design is sufficiently powered to detect an interaction effect, and what that minimal effect would be in magnitude, given the specifics of this design.

<!-- REVIEW: More straight forward trade-off example? -->
<!-- REVIEW: Need to add screenshots -->




## 3 Export fancy figures

Diagnostic graphs created in 2) can be downloaded as `.png` or `.R` files, where users are able to further customize the output figure by downloading its source code and editing it directly on a local R or RStudio session.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(shiny); library(shinyjs); library(shinymaterial)
source("ddwizard_post_helpers.R")

text3 <- c(
  add_title("Create a plot",
            "Select the estimand, estimator and term to be displayed, the parameter to appear on the x-axis and any other parameters to be displayed in the color aesthetics (optional) or along different plots (optional). (These last two options are only available when multiple parameters are being varied in the diagnosis)."),

  add_title("Download as image or R source code",
            "Download the graph as .png OR download the code to generate the plot and the relevant data as an .R file."),

  add_title("Customize",
            "The option to download the R code for the plot allows users to further customize plot features by editing its source script. To add custom title and axes labels, for example, replace line <code>labs(x = 'N', y = 'power')</code> with <code>labs(title = 'Power of Treatment Effect Estimate', x = 'Sample size', y = 'Power')</code>, and rerun the script."
            ))

imageGallery("ex3", text3)
```

## 4. Use it for teaching

Many designers available in the DDWizard allow users to examine and illustrate how design-based inferences are affected when specific model assumptions are not satisfied. This can wield the DDWizard certain didactic purposes. For example, the `Binary IV` design arguments can be defined in such a way that violates one or more assumptions for a strong instrumental variable. Similarly, the `Mediation design` allows users to explore design properties under the violation of sequential ignorability and heterogeneous effects. Simulating and diagnosing such designs helps illustrate the magnitude and direction of bias and other properties when each assumption is violated separately, as well as what estimates are affected by or perform best under these scenarios.

<!-- REVIEW: Show step-by-step of specific manipulations and takeaways? -->

## 5. Steal our code

The interface of the app also offers a basic overview of the structure of design declarations R scripts and offer a stepping stone for more idiosyncratic or more complex factorial designs.

## 6. Leave the library: Use the wizard package to show off and share your own designs

For more advanced R and _DeclareDesign_ users, the DDWizard can serve as an interactive interface for exploring the properties of any custom-made designer function. Exploring this functionality of the DDWizard for that purpose requires users to:

1. Add new designer function(s) to _DesignLibrary_ by following instructions [here](https://declaredesign.org/library/articles/how_to_write_and_contribute_designers.html) and saving function(s) in the `"R/"` directory of the package;
2. Reinstall _DesignLibrary_ containing the new designer function(s);
3. Download or clone _DDWizard_ [here](https://github.com/DeclareDesign/DDWizard) and run `runApp()` on the app directory.

A version of the DDWizard should then run locally with new function(s) appearing in the dropdown menu below `Choose design`.

## Feedback

The DDWizard is still under development. We encourage you to report issues, make feature requests, or contribute to developing the app [on our Github repository](https://github.com/DeclareDesign/DDWizard/issues).
